{
    "sourceFile": "createTable.sql",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1691741860487,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1691741860487,
            "name": "Commit-0",
            "content": "-- dropping existing tables \r\n-- for first run,skip this part \r\n\r\nDROP SEQUENCE order_id_seq;\r\nDROP SEQUENCE activity_id_seq;\r\nDROP SEQUENCE user_id_seq;\r\nDROP SEQUENCE employee_id_seq;\r\n\r\nCREATE SEQUENCE user_id_seq START WITH 1000 INCREMENT BY 10 NOCACHE NOCYCLE;\r\nCREATE SEQUENCE activity_id_seq START WITH 1000 INCREMENT BY 10 NOCACHE NOCYCLE;\r\nCREATE SEQUENCE order_id_seq START WITH 10 INCREMENT BY 1 NOCACHE NOCYCLE;\r\nCREATE SEQUENCE employee_id_seq START WITH 100 INCREMENT BY 10 NOCACHE NOCYCLE;\r\n\r\n\r\nDROP TABLE OWNS;\r\nDROP TABLE \"ORDER\";\r\nDROP TABLE PORTFOLIO;\r\nDROP TABLE CUSTOMER;\r\nDROP TABLE PARTICIPATION;\r\nDROP TABLE BROKER;\r\nDROP TABLE ACTIVITY;\r\nDROP TABLE \"BACKUP STOCK\";\r\nDROP TABLE STOCK;\r\nDROP TABLE CORPORATION;\r\nDROP TABLE ADMIN;\r\nDROP TABLE USER_CONTACT;\r\nDROP TABLE \"USER\";\r\nDROP TABLE EMP_CONTACT;\r\nDROP TABLE EMPLOYEE;\r\n\r\n\r\n\r\n--  user table\r\nCREATE TABLE \"USER\" (\r\n    USER_ID INTEGER DEFAULT user_id_seq.NEXTVAL NOT NULL,\r\n    NAME VARCHAR2 (100) NOT NULL,\r\n    PWD VARCHAR2 (128) NOT NULL,\r\n    EMAIL VARCHAR2 (255) NOT NULL,\r\n    \"TYPE\" VARCHAR2 (30) NOT NULL,\r\n    STREET_NO VARCHAR2(10),\r\n    STREET_NAME VARCHAR2(100),\r\n    CITY VARCHAR2(20) NOT NULL,\r\n    COUNTRY VARCHAR2(30) NOT NULL,\r\n    ZIP VARCHAR2(12) NOT NULL,\r\n    REG_DATE DATE NOT NULL,\r\n    CONSTRAINT PK_USER PRIMARY KEY (USER_ID),\r\n    CONSTRAINT CHK_PWD_LENGTH CHECK (LENGTH(PWD) = 128),\r\n    CONSTRAINT CHK_USER_EMAIL_FORMAT CHECK (REGEXP_LIKE(EMAIL, '[a-z0-9]+@[a-z]+\\.[a-z]{2,3}', 'i')),\r\n    CONSTRAINT CHK_USER_TYPE CHECK(\"TYPE\" IN ('Admin','Corp','Broker','Customer')),\r\n    CONSTRAINT CHK_REG_DATE CHECK(REG_DATE > TO_DATE('1-1-2015','DD-MM-YYYY'))\r\n);\r\n\r\n\r\nCREATE TABLE USER_CONTACT (\r\n    USER_ID INTEGER NOT NULL,\r\n    CONTACT VARCHAR ( 20 ) NOT NULL,\r\n    CONSTRAINT PK_USER_CONTACT PRIMARY KEY ( USER_ID, CONTACT ),\r\n    CONSTRAINT CHK_CONTACT_FORMAT CHECK ( REGEXP_LIKE ( CONTACT, '^[\\+]?[(]?[0-9]{3}[)]?[-\\s\\.]?[0-9]{3}[-\\s\\.]?[0-9]{4,6}$' ) ),\r\n    CONSTRAINT FK_USER_CONTACT_USER_ID FOREIGN KEY ( USER_ID ) REFERENCES \"USER\" ( USER_ID ) \r\n        ON DELETE CASCADE \r\n);\r\n\r\n\r\n\r\n\r\n\r\n\r\n--  employee table\r\n\r\nCREATE TABLE EMPLOYEE (\r\n    EMPLOYEE_ID  INTEGER DEFAULT employee_id_seq.NEXTVAL NOT NULL,\r\n    FIRST_NAME VARCHAR2 ( 50 ) NOT NULL,\r\n    LAST_NAME VARCHAR2 ( 50 ) NOT NULL,\r\n\t\tEMAIL VARCHAR2 (255) NOT NULL,\r\n    SEX CHAR(1) ,\r\n    NID VARCHAR2 ( 20 ) ,\r\n    DESIGNATION VARCHAR2 ( 100 ),\r\n    ADDRESS VARCHAR2 ( 100 ),\r\n    ZIP_CODE VARCHAR2 ( 10 ),\r\n    SALARY NUMBER ( 10, 2 ),\r\n    HIRE_DATE DATE ,\r\n    DOB DATE ,\r\n    MANAGER_ID INTEGER,\r\n    CONSTRAINT PK_EMPLOYEE PRIMARY KEY ( EMPLOYEE_ID ),\r\n    CONSTRAINT CHK_EMPLOYEE_SEX CHECK (SEX in ('M', 'F')),\r\n    CONSTRAINT CHK_EMPLOYEE_NID CHECK (REGEXP_LIKE(NID, '^[0-9]+$')),\r\n\t\tCONSTRAINT CHK_EMP_EMAIL_FORMAT CHECK (REGEXP_LIKE(EMAIL, '[a-z0-9]+@[a-z]+\\.[a-z]{2,3}', 'i')),\r\n    CONSTRAINT CHK_EMPLOYEE_HIRE_DATE CHECK (HIRE_DATE > TO_DATE('2015-01-01', 'YYYY-MM-DD')),\r\n    CONSTRAINT CHK_EMPLOYEE_DOB CHECK (EXTRACT(YEAR FROM DOB) > 1900),\r\n    CONSTRAINT FK_EMPLOYEE_MANAGER_ID FOREIGN KEY ( MANAGER_ID ) REFERENCES EMPLOYEE ( EMPLOYEE_ID ) \r\n);\r\n\r\n\r\n\r\nCREATE TABLE EMP_CONTACT (\r\n    EMPLOYEE_ID INTEGER NOT NULL,\r\n    CONTACT VARCHAR ( 20 ) NOT NULL ,\r\n    CONSTRAINT PK_EMP_CONTACT PRIMARY KEY ( EMPLOYEE_ID, CONTACT ),\r\n    CONSTRAINT FK_EMP_CONTACT_EMPLOYEE_ID FOREIGN KEY ( EMPLOYEE_ID ) REFERENCES EMPLOYEE ( EMPLOYEE_ID ) ON DELETE CASCADE ,\r\n\t\tCONSTRAINT CHK_EMP_CONTACT_CONTACT CHECK ( REGEXP_LIKE ( CONTACT, '^[\\+]?[(]?[0-9]{3}[)]?[-\\s\\.]?[0-9]{3}[-\\s\\.]?[0-9]{4,6}$' ) )\r\n);\r\n\r\n\r\n\r\n-- admin table \r\nCREATE TABLE ADMIN(\r\n    ADMIN_ID INTEGER NOT NULL,\r\n    ADDER_ID INTEGER,\r\n    EMPLOYEE_ID INTEGER NOT NULL,\r\n    CONSTRAINT PK_ADMIN PRIMARY KEY(ADMIN_ID),\r\n    CONSTRAINT FK_ADMIN_USER_ID FOREIGN KEY(ADMIN_ID) REFERENCES \"USER\" ( USER_ID ) ON DELETE CASCADE,\r\n    CONSTRAINT FK_ADMIN_EMPLOYEE_ID FOREIGN KEY(EMPLOYEE_ID) REFERENCES EMPLOYEE ( EMPLOYEE_ID ) ON DELETE CASCADE,\r\n    CONSTRAINT FK_ADMIN_ADDER_ID FOREIGN KEY(ADDER_ID) REFERENCES ADMIN(ADMIN_ID)\r\n);\r\n\r\n\r\n\r\n-- corporation table \r\nCREATE TABLE CORPORATION(\r\n    CORP_ID INTEGER NOT NULL,\r\n    CORP_REG_NO INTEGER NOT NULL,\r\n    SECTOR VARCHAR2(30) NOT NULL,\r\n    CONSTRAINT PK_CORPORATION PRIMARY KEY(CORP_ID),\r\n    CONSTRAINT FK_CORPORATION_USER_ID FOREIGN KEY(CORP_ID) REFERENCES \"USER\" ( USER_ID ) ON DELETE CASCADE\r\n);\r\n\r\n\r\n--\tstock table \r\nCREATE TABLE STOCK (\r\n  SYMBOL VARCHAR2(10) NOT NULL,\r\n\tCORP_ID INTEGER,\r\n\tUPDATE_TIME TIMESTAMP NOT NULL,\r\n  VALUE NUMBER(10, 2) NOT NULL,\r\n  PRICE NUMBER(10, 2) NOT NULL,\r\n  LTP NUMBER(10, 2) NOT NULL,\r\n  AVAILABLE_LOTS INTEGER ,\r\n  LOT INTEGER,\r\n  BLOCKED CHAR(1) ,\r\n\tCONSTRAINT CHK_BLOCKED CHECK (BLOCKED IN ('T', 'F')),\r\n  CONSTRAINT PK_STOCK_SYMBOL PRIMARY KEY (SYMBOL),\r\n\tCONSTRAINT FK_STOCK_CORP_ID FOREIGN KEY (CORP_ID) REFERENCES CORPORATION (CORP_ID) ON DELETE SET NULL,\r\n\tCONSTRAINT CHK_STOCK_NON_NEGATIVE CHECK (PRICE >= 0 AND VALUE >= 0 AND LTP >= 0 AND AVAILABLE_LOTS >= 0)\r\n);\r\n\r\n\r\n-- backup stock \r\nCREATE TABLE \"BACKUP STOCK\" (\r\n\tSYMBOL VARCHAR2 ( 10 ) NOT NULL,\r\n\tUPDATE_TIME TIMESTAMP NOT NULL,\r\n\tVALUE NUMBER ( 10, 2 ) NOT NULL,\r\n\tPRICE NUMBER ( 10, 2 ) NOT NULL,\r\n\tAVAILABLE_LOTS INTEGER,\r\n\tCONTROLLER_ID INTEGER,\r\n\tCONSTRAINT PK_BACKUP_STOCK PRIMARY KEY ( SYMBOL ),\r\n\tCONSTRAINT FK_BACKUP_STOCK_CONTROLLER_ID FOREIGN KEY ( CONTROLLER_ID ) REFERENCES ADMIN ( ADMIN_ID ) \r\n\t\tON DELETE SET NULL,\r\n\tCONSTRAINT CHK_BACKUP_STOCK_NON_NEGATIVE CHECK ( PRICE >= 0 AND VALUE >= 0 AND AVAILABLE_LOTS >= 0 ) \r\n);\r\n\r\n\r\n\r\n\r\n\r\n\r\n-- activity table \r\n\r\nCREATE TABLE ACTIVITY (\r\n    ACTIVITY_ID INTEGER DEFAULT activity_id_seq.NEXTVAL NOT NULL,\r\n    CORP_ID INTEGER NOT NULL,\r\n    \"DATE\" DATE NOT NULL ,\r\n    START_TIME TIMESTAMP NOT NULL,\r\n    END_TIME TIMESTAMP NOT NULL,\r\n    \"TYPE\" VARCHAR2 ( 50 ) NOT NULL,\r\n    VENUE VARCHAR2 ( 100 ),\r\n    FEE NUMBER ( 10, 2 ),\r\n    DESCRIPTION VARCHAR2 ( 200 ),\r\n    CONSTRAINT PK_ACTIVITY PRIMARY KEY ( ACTIVITY_ID ),\r\n    CONSTRAINT CHK_ACTIVITY_DATE CHECK (\"DATE\" > TO_DATE('1-1-2015','DD-MM-YYYY')),\r\n    CONSTRAINT FK_ACTIVITY_CORP_ID FOREIGN KEY ( CORP_ID ) REFERENCES CORPORATION ( CORP_ID ) \r\n        ON DELETE CASCADE\r\n);\r\n\r\n\r\n-- participation table \r\nCREATE TABLE PARTICIPATION (\r\n    ACTIVITY_ID INTEGER NOT NULL,\r\n    USER_ID INTEGER NOT NULL,\r\n    PMT_STATUS VARCHAR2 ( 10 ) ,\r\n\t\tCONSTRAINT CHK_PMT_STATUS CHECK ( PMT_STATUS IN ( 'Paid', 'Not Paid' ) ),\r\n    CONSTRAINT PK_PARTICIPATION PRIMARY KEY ( ACTIVITY_ID, USER_ID ),\r\n    CONSTRAINT FK_PARTICIPATION_ACTIVITY_ID FOREIGN KEY ( ACTIVITY_ID ) REFERENCES ACTIVITY ( ACTIVITY_ID )\r\n        ON DELETE CASCADE,\r\n    CONSTRAINT FK_PARTICIPATION_USER_ID FOREIGN KEY ( USER_ID ) REFERENCES \"USER\" ( USER_ID ) \r\n        ON DELETE CASCADE\r\n);\r\n\r\n-- broker table \r\nCREATE TABLE BROKER (\r\n    USER_ID INTEGER NOT NULL,\r\n    LICENSE_NO VARCHAR2(20) NOT NULL,\r\n    COMMISSION_PCT NUMBER(5, 2),\r\n    EXPERTISE VARCHAR2(100),\r\n    CONSTRAINT PK_BROKER PRIMARY KEY (USER_ID),\r\n    CONSTRAINT FK_BROKER_USER_ID FOREIGN KEY (USER_ID) REFERENCES \"USER\" (USER_ID)\r\n        ON DELETE CASCADE\r\n);\r\n\r\n\r\n-- customer table \r\nCREATE TABLE CUSTOMER (\r\n    USER_ID INTEGER,\r\n    ACCOUNT_NO VARCHAR2(20) NOT NULL,\r\n    REFERER_ID INTEGER,\r\n    REFER_COUNT INTEGER DEFAULT 0,\r\n    BROKER_ID INTEGER,\r\n    CONSTRAINT PK_CUSTOMER PRIMARY KEY (USER_ID),\r\n    CONSTRAINT FK_CUSTOMER_BROKER_ID FOREIGN KEY (BROKER_ID) REFERENCES BROKER (USER_ID) ON DELETE SET NULL,\r\n    CONSTRAINT FK_CUSTOMER_USER_ID FOREIGN KEY (USER_ID) REFERENCES \"USER\" (USER_ID) ON DELETE CASCADE,\r\n    CONSTRAINT FK_CUSTOMER_REFER_ID FOREIGN KEY (REFERER_ID) REFERENCES CUSTOMER (USER_ID) ON DELETE SET NULL\r\n);\r\n\r\n\r\n\r\n\r\n\r\n-- portfolio table \r\nCREATE TABLE PORTFOLIO (\r\n    USER_ID INTEGER NOT NULL,\r\n    SECTOR VARCHAR2(30) NOT NULL,\r\n    BUY_AMOUNT NUMBER(10, 2),\r\n    SELL_AMOUNT NUMBER(10, 2),\r\n    CASH_AMOUNT NUMBER(10, 2),\r\n    CONSTRAINT PK_PORTFOLIO PRIMARY KEY (USER_ID, SECTOR),\r\n    CONSTRAINT FK_PORTFOLIO_USER_ID FOREIGN KEY (USER_ID) REFERENCES CUSTOMER (USER_ID) ON DELETE CASCADE\r\n);\r\n\r\n\r\n-- order table \r\n\r\nCREATE TABLE \"ORDER\" (\r\n    ORDER_ID INTEGER DEFAULT order_id_seq.NEXTVAL NOT NULL,\r\n    SYMBOL VARCHAR2(10) NOT NULL,\r\n    USER_ID INTEGER NOT NULL,\r\n    SECTOR VARCHAR2(30) NOT NULL,\r\n    STATUS VARCHAR2(20) ,\r\n    \"TYPE\" VARCHAR2(10) ,\r\n    LATEST_PRICE NUMBER(10, 2) DEFAULT 0,\r\n    LATEST_QUANTITY INTEGER DEFAULT 0,\r\n    LATEST_UPDATE_TIME TIMESTAMP,\r\n    TRANSACTION_FEE NUMBER(10, 2) DEFAULT 0,\r\n    TRANSACTION_TIME TIMESTAMP,\r\n    CONSTRAINT PK_ORDER PRIMARY KEY(ORDER_ID),\r\n    CONSTRAINT FK_ORDER_SYMBOL FOREIGN KEY(SYMBOL) REFERENCES STOCK(SYMBOL) ON DELETE SET NULL,\r\n    CONSTRAINT FK_ORDER_USER_PORTFOLIO FOREIGN KEY(USER_ID, SECTOR) REFERENCES PORTFOLIO(USER_ID, SECTOR) ON DELETE CASCADE,\r\n    CONSTRAINT CHK_ORDER_PRICES CHECK(LATEST_PRICE >= 0 AND LATEST_QUANTITY >=0 AND TRANSACTION_FEE >= 0),\r\n    CONSTRAINT CHK_ORDER_STATUS CHECK (UPPER(STATUS) IN ('PENDING','COMPLETE')),\r\n    CONSTRAINT CHK_ORDER_TYPE CHECK (UPPER(\"TYPE\") IN ('BUY','SELL'))\r\n);\r\n\r\n\r\n-- owns table \r\nCREATE TABLE OWNS(\r\n    USER_ID INTEGER NOT NULL,\r\n    SECTOR VARCHAR2(30) NOT NULL,\r\n    SYMBOL VARCHAR2(10) NOT NULL,\r\n    QUANTITY INTEGER DEFAULT(0),\r\n    CONSTRAINT PK_OWNS PRIMARY KEY(USER_ID),\r\n    CONSTRAINT FK_OWNS_PORTFOLIO FOREIGN KEY(USER_ID, SECTOR) REFERENCES PORTFOLIO(USER_ID, SECTOR) ON DELETE CASCADE,\r\n    CONSTRAINT FK_OWNS_STOCK FOREIGN KEY(SYMBOL) REFERENCES STOCK(SYMBOL) ON DELETE SET NULL\r\n);\r\n\r\n\r\n\r\n\r\n"
        }
    ]
}