CREATE OR REPLACE TRIGGER update_stock_time
BEFORE UPDATE ON STOCK
FOR EACH ROW
BEGIN
    :NEW.UPDATE_TIME := CURRENT_TIMESTAMP;
END;
/

CREATE OR REPLACE TRIGGER update_corresponding_symbols
AFTER UPDATE OF SYMBOL ON STOCK
FOR EACH ROW
BEGIN
    -- Update symbol in BACKUP_STOCK
    UPDATE "BACKUP STOCK"
    SET SYMBOL = :new.SYMBOL
    WHERE SYMBOL = :old.SYMBOL;
    
    -- Update symbol in ORDER
    UPDATE "ORDER"
    SET SYMBOL = :new.SYMBOL
    WHERE SYMBOL = :old.SYMBOL;
    
    -- Update symbol in OWNS
    UPDATE OWNS
    SET SYMBOL = :new.SYMBOL
    WHERE SYMBOL = :old.SYMBOL;
END;
/

CREATE OR REPLACE TRIGGER insert_corp_into_owns
AFTER INSERT 
ON STOCK 
FOR EACH ROW 
BEGIN
IF :NEW.AVAILABLE_LOTS IS NOT NULL AND :NEW.LOT IS NOT NULL THEN 
	INSERT INTO OWNS VALUES(:NEW.CORP_ID,:NEW.SYMBOL,:NEW.AVAILABLE_LOTS*:NEW.LOT);
END IF;
END;
/ 

CREATE OR REPLACE TRIGGER update_quantity_of_stock
AFTER UPDATE OF AVAILABLE_LOTS,LOT 
ON STOCK 
FOR EACH ROW
BEGIN 
UPDATE OWNS 
SET QUANTITY = :NEW.AVAILABLE_LOTS*:NEW.LOT 
WHERE USER_ID = :NEW.CORP_ID AND SYMBOL = :NEW.SYMBOL;
END;
/